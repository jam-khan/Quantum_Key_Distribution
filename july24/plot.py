import matplotlib.pyplot as plt
import numpy as np
from scipy.interpolate import make_interp_spline

def plot_multiple_curves(k_values, pairs_array):
    """
    Plots multiple sets of (x, y) pairs using Matplotlib with specific axis labels and ranges.
    Connects the points with smooth curves and labels each curve with a different color corresponding to k values.
    
    Parameters:
    k_values (list): A list of k values.
    pairs_array (list of lists of tuples): A list where each element is a list of (x, y) pairs corresponding to a k value.
    """
    # Define the Y-axis range
    y_min, y_max = -0.1, np.log2(3)
    
    # Define the X-axis range
    x_min, x_max = 0.80, 1.0
    
    # Create a plot
    plt.figure(figsize=(10, 6))
    # Define a color map
    colors = plt.cm.viridis(np.linspace(0, 1, len(k_values)))
    
    for i, pairs in enumerate(pairs_array):
        # Unzip the pairs into two separate lists for x and y coordinates
        x_values, y_values = zip(*pairs)
        
        # Create a smooth curve using B-spline interpolation
        x_new = np.linspace(min(x_values), max(x_values), 300)
        spl = make_interp_spline(x_values, y_values, k=3)
        y_smooth = spl(x_new)
        
        # Plot the smooth curve
        plt.plot(x_new, y_smooth, color=colors[i], linestyle='-', label=f'k = {k_values[i]}')
        
        # Scatter plot
        # plt.scatter(x_values, y_values, color=colors[i], marker='o')
    
    # Add titles and labels
    plt.title('Randomness Certification')
    plt.xlabel('v')
    plt.ylabel('Randomness [bits]')
    
    # Set axis ranges
    plt.ylim(y_min, y_max)
    plt.xlim(x_min, x_max)
    
    # Add custom Y-axis tick labels
    y_ticks = np.linspace(0, y_max, num=7)
    y_tick_labels = [f'{tick:.2f}' for tick in y_ticks[:-1]] + ['log2(3)']
    plt.yticks(y_ticks, y_tick_labels)
    
    # Show legend
    plt.legend()
    
    # Show the plot
    plt.grid(False)
    plt.show()

# Example usage
k_values = [2, 1, 0.5]
pairs_array = [
        [   (0.8, 0),
            (0.8051282051282052, 0),
            (0.8102564102564103, 0),
            (0.8153846153846154, 0),
            (0.8205128205128205, 0),
            (0.8256410256410256, 0),
            (0.8307692307692308, 0),
            (0.8358974358974359, 0),
            (0.841025641025641, 0),
            (0.8461538461538461, 0),
            (0.8512820512820513, 0),
            (0.8564102564102564, 0.0032551175495222316),
            (0.8615384615384616, 0.01958973828313136),
            (0.8666666666666667, 0.041954613241043354),
            (0.8717948717948718, 0.06360949020197931),
            (0.8769230769230769, 0.08656788137021654),
            (0.882051282051282, 0.11033941685883158),
            (0.8871794871794871, 0.13451316900771437),
            (0.8923076923076924, 0.15909826723009862),
            (0.8974358974358975, 0.18400726651822594),
            (0.9025641025641026, 0.20932778900200502),
            (0.9076923076923077, 0.23542436581651935),
            (0.9128205128205128, 0.2625965089225644),
            (0.9179487179487179, 0.29001667723581726),
            (0.9230769230769231, 0.31797522745978674),
            (0.9282051282051282, 0.3472548882224158),
            (0.9333333333333333, 0.3767906523793095),
            (0.9384615384615385, 0.4079231642942528),
            (0.9435897435897436, 0.4398411261061439),
            (0.9487179487179487, 0.4729854527236768),
            (0.9538461538461539, 0.5077701038281356),
            (0.958974358974359, 0.5439078053092272),
            (0.9641025641025641, 0.5833692524741766),
            (0.9692307692307692, 0.6278196152938174),
            (0.9743589743589743, 0.6860449945587733),
            (0.9794871794871794, 0.7483911721711202),
            (0.9846153846153847, 0.8221519058685143),
            (0.9897435897435898, 0.91870788093334),
            (0.9948717948717949, 1.0614371810275227),
            (1.0, 1.5510629936461002)],
        [   (0.80, 0),
            (0.81, 0),
            (0.82, 0),
            (0.83, 0),
            (0.84, 0),
            (0.85, 0),
            (0.86, 0),
            (0.87, 0),
            (0.88, 0),
            (0.89, 0),
            (0.90, 0),
            (0.9052631578947369, 0),
            (0.9105263157894737, 0),
            (0.9157894736842105, 0),
            (0.9210526315789473, 0.020713357432896044),
            (0.9263157894736842, 0.06808675682547398),
            (0.9315789473684211, 0.12640572353694754),
            (0.9368421052631579, 0.16854158403023314),
            (0.9421052631578948, 0.2315428548640687),
            (0.9473684210526315, 0.2769050074270642),
            (0.9526315789473684, 0.3465918240133032),
            (0.9578947368421052, 0.40647706454802224),
            (0.9631578947368421, 0.4575010893778132),
            (0.968421052631579, 0.5235506669751643),
            (0.9736842105263158, 0.6090532319564583),
            (0.9789473684210527, 0.6671194429360144),
            (0.9842105263157894, 0.7595066339173236),
            (0.9894736842105263, 0.8567487211969756),
            (0.9947368421052631, 0.9999763669282911),
            (1.0, 1.54894726310632)],
        [(0.8, -0.00011053829258343586),
        (0.8051282051282052, -0.00012159924097083923),
        (0.8102564102564103, -0.00015781410120628352),
        (0.8153846153846154, -0.00016590445298730945),
        (0.8205128205128205, -6.635968081954663e-5),
        (0.8256410256410256, -1.6555697051382116e-5),
        (0.8307692307692308, -8.833988305776291e-5),
        (0.8358974358974359, -0.00012149508802526195),
        (0.841025641025641, -0.00022041295064304455),
        (0.8461538461538461, -6.165334298758465e-5),
        (0.8512820512820513, -8.741449626838914e-5),
        (0.8564102564102564, -0.0001506194887653104),
        (0.8615384615384616, -5.5213314039685256e-5),
        (0.8666666666666667, -9.827386901045988e-5),
        (0.8717948717948718, -4.1156019056788805e-5),
        (0.8769230769230769, -8.239513332904479e-5),
        (0.882051282051282, -3.9884366017013715e-5),
        (0.8871794871794871, -0.00010383767435352185),
        (0.8923076923076924, -5.9072294852898695e-5),
        (0.8974358974358975, -4.070394789905868e-5),
        (0.9025641025641026, -3.371112082482626e-5),
        (0.9076923076923077, -3.310226186797215e-5),
        (0.9128205128205128, -5.4474093597201794e-5),
        (0.9179487179487179, -1.8390870035556476e-5),
        (0.9230769230769231, -1.7498624442996003e-5),
        (0.9282051282051282, -6.797496284922598e-5),
        (0.9333333333333333, -2.4203480754128837e-5),
        (0.9384615384615385, -1.60202300873412e-5),
        (0.9435897435897436, -5.905691220592792e-6),
        (0.9487179487179487, -8.622729069598267e-5),
        (0.9538461538461539, -0.00013247134394285415),
        (0.958974358974359, 0.04076762679918343),
        (0.9641025641025641, 0.1345102941348022),
        (0.9692307692307692, 0.24428431564302377),
        (0.9743589743589743, 0.36532125597635634),
        (0.9794871794871794, 0.4740210556771448),
        (0.9846153846153847, 0.6042908088011147),
        (0.9897435897435898, 0.7362913420856487),
        (0.9948717948717949, 1.0085927407767832),
        (1.0, 1.5461897784118264)]
]
plot_multiple_curves(k_values, pairs_array)

# Example usage
# pairs = [(4.1, 0.5), (4.2, 0.7), (4.3, 0.9), (4.4, 1.1), (4.5, 1.3), (4.6, 1.5)]
# plot_xy_pairs_with_details(pairs)

# Example usage
# pairs = [(4.01, 0),
#         (4.062105263157894, 0),
#         (4.114210526315789, 0),
#         (4.166315789473685, 0),
#         (4.218421052631579, 0.003443015708558455),
#         (4.270526315789474, 0.039581826257855356),
#         (4.322631578947369, 0.08099517715404568),
#         (4.374736842105263, 0.12519939545113454),
#         (4.426842105263158, 0.17142423789126401),
#         (4.478947368421053, 0.21938989315328764),
#         (4.531052631578947, 0.2693066621839655),
#         (4.583157894736842, 0.32131522523476264),
#         (4.6352631578947365, 0.376231084321439),
#         (4.687368421052631, 0.4348240679660648),
#         (4.739473684210527, 0.4974702331894018),
#         (4.791578947368421, 0.5661657594378091),
#         (4.843684210526316, 0.6493347479458591),
#         (4.895789473684211, 0.7695199322910391),
#         (4.947894736842105, 0.939198227888254),
#         (5.0, 1.5510629936461002)]


# plot_xy_pairs_with_details(pairs)